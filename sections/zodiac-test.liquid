{% liquid
  assign color_scheme = section.settings.color_scheme
%}

<link rel="stylesheet" href="{{ 'zodiac-test.css' | asset_url }}">

<section class="zodiac-test" data-color-scheme="{{ color_scheme }}">
  <div class="zodiac-test__background">
    <img src="{{ 'zodiac-bg.jpg' | asset_url }}" alt="" loading="lazy">
  </div>

  <div class="zodiac-test__container">
    <zodiac-calculator class="zodiac-test__calculator">
      <!-- 初始状态：欢迎页 -->
      <div class="zodiac-test__screen zodiac-test__screen--welcome active" data-screen="welcome">
        <div class="zodiac-test__welcome-content">
          <h1 class="zodiac-test__title">{{ 'sections.zodiac_test.welcome_title' | t }}</h1>
          <p class="zodiac-test__subtitle">{{ 'sections.zodiac_test.welcome_subtitle' | t }}</p>
          <button type="button" class="zodiac-test__button zodiac-test__button--primary" data-action="start">
            {{ 'sections.zodiac_test.start_button' | t }}
          </button>
        </div>
      </div>

      <!-- 输入状态：日期选择 -->
      <div class="zodiac-test__screen zodiac-test__screen--input" data-screen="input">
        <div class="zodiac-test__input-content">
          <h2 class="zodiac-test__input-title">{{ 'sections.zodiac_test.input_title' | t }}</h2>
          <div class="zodiac-test__date-input">
            <label class="zodiac-test__label">{{ 'sections.zodiac_test.date_label' | t }}</label>
            <input type="date" class="zodiac-test__date-field" data-birth-date>
          </div>
          <button type="button" class="zodiac-test__button zodiac-test__button--primary" data-action="calculate" disabled>
            {{ 'sections.zodiac_test.calculate_button' | t }}
          </button>
        </div>
      </div>

      <!-- 结果状态：生肖展示 -->
      <div class="zodiac-test__screen zodiac-test__screen--result" data-screen="result">
        <div class="zodiac-test__result-content">
          <h2 class="zodiac-test__result-title">{{ 'sections.zodiac_test.result_title_prefix' | t }}<span data-zodiac-name></span></h2>
          <div class="zodiac-test__result-image">
            <img data-zodiac-image src="" alt="">
          </div>
          <button type="button" class="zodiac-test__button zodiac-test__button--secondary" data-action="restart">
            {{ 'sections.zodiac_test.restart_button' | t }}
          </button>
        </div>

        <!-- 生肖详情区域 -->
        <div class="zodiac-test__details">
          <h3 class="zodiac-test__details-title">{{ 'sections.zodiac_test.details_title' | t }}</h3>
          <div class="zodiac-test__details-content" data-zodiac-details>
            <!-- JavaScript 动态填充 -->
          </div>
        </div>

        <!-- 相关产品推荐 -->
        {% if section.settings.show_products %}
          <div class="zodiac-test__products">
            <h3 class="zodiac-test__products-title" data-products-title></h3>
            <div class="zodiac-test__products-grid" data-products-grid>
              <!-- JavaScript 动态填充产品 -->
            </div>
          </div>
        {% endif %}
      </div>
    </zodiac-calculator>
  </div>
</section>

<script>
  // 当前语言
  window.zodiacCurrentLocale = "{{ request.locale.iso_code }}";

  // 将生肖图片URL映射传递给JavaScript
  window.zodiacImageUrls = {
    'rat': "{{ 'zodiac-rat.png' | asset_url }}",
    'ox': "{{ 'zodiac-ox.png' | asset_url }}",
    'tiger': "{{ 'zodiac-tiger.png' | asset_url }}",
    'rabbit': "{{ 'zodiac-rabbit.png' | asset_url }}",
    'dragon': "{{ 'zodiac-dragon.png' | asset_url }}",
    'snake': "{{ 'zodiac-snake.png' | asset_url }}",
    'horse': "{{ 'zodiac-horse.png' | asset_url }}",
    'goat': "{{ 'zodiac-goat.png' | asset_url }}",
    'monkey': "{{ 'zodiac-monkey.png' | asset_url }}",
    'rooster': "{{ 'zodiac-rooster.png' | asset_url }}",
    'dog': "{{ 'zodiac-dog.png' | asset_url }}",
    'pig': "{{ 'zodiac-pig.png' | asset_url }}"
  };
</script>
<script src="{{ 'zodiac-calculator-i18n.js' | asset_url }}"></script>
<script src="{{ 'zodiac-calculator.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "t:sections.zodiac_test.name",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.color_scheme.label",
      "default": "scheme-1"
    },
    {
      "type": "checkbox",
      "id": "show_products",
      "label": "t:sections.zodiac_test.settings.show_products.label",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "t:sections.zodiac_test.name"
    }
  ]
}
{% endschema %}
